(function($){$.widget("ui.igTileManager",{css:{container:"ui-widget ui-igtilemanager",header:"ui-widget-header ui-igtile-header",content:"ui-widget-content ui-igtile",innerContainer:"ui-igtile-inner-container",expandButton:"ig-button ig-tile-expand-button ui-state-default",expandIcon:"ui-icon ig-tile-expand-icon",collapseIcon:"ui-icon ig-tile-collapse-icon",minimizeButton:"ig-button ig-tile-minimize-button ui-state-default",minimizeIcon:"ui-icon ig-tile-minimize-icon",unminimizeIcon:"ui-icon ig-tile-unminimize-icon",hoverClass:"ui-state-hover"},options:{layoutConfiguration:null,dataSource:null,headerTemplate:null,contentTemplate:null,headerSelector:null,minimizeSelector:".ig-tile-minimize-button",maximizeSelector:".ig-tile-expand-button",animationDuration:500,dataSourceUrl:null,responseDataKey:null,responseDataType:null,dataSourceType:null,requestType:"GET",responseContentType:null},events:{dataBinding:"dataBinding",dataBound:"dataBound",rendering:"rendering",rendered:"rendered",tileFocusing:"tileFocusing",tileFocused:"tileFocused",tilesRestoring:"tilesRestoring",tilesRestored:"tilesRestored",tileMinimizing:"tileMinimizing",tileMinimized:"tileMinimized",tileMaximizing:"tileMaximizing",tileMaximized:"tileMaximized"},_createWidget:function(options,element){this.options.layoutConfiguration={layoutMode:"grid",items:[],gridLayout:{marginTop:0,marginLeft:0}};$.Widget.prototype._createWidget.apply(this,arguments)},_create:function(){var opt=this.options;this.element.addClass(this.css.container);this._analyzeConfig();if(opt.dataSource!==null){this.dataBind()}else{this._fromMarkup=true;opt.maximizeSelector=opt.maximizeSelector===".ig-tile-expand-button"?".ui-igtile":opt.maximizeSelector;opt.minimizeSelector=opt.minimizeSelector===".ig-tile-minimize-button"?null:opt.minimizeSelector;this._initFromMarkup()}this._attachEvents()},_setOption:function(option,value){if(this.options[option]===value){return}$.Widget.prototype._setOption.apply(this,arguments);switch(option){case"dataSource":this.element.igLayoutManager("destroy");this.element.empty();this.dataBind();break;case"layoutConfiguration":this._analyzeConfig();if(this._fromMarkup){this.element.igLayoutManager("destroy");this._initFromMarkup()}else{this.element.igLayoutManager("destroy");this.element.empty();this.dataBind()}break;default:break}},_analyzeConfig:function(){this._analyzeHeight();this._analyzeWidth()},_analyzeWidth:function(){var config=this.options.layoutConfiguration.gridLayout,units;if(typeof config.columnWidth==="string"){if(config.columnWidth.indexOf("%")!==-1){units=config.columnWidth.substring(0,config.columnWidth.length-1);units=parseInt(units,10)/100;if(!isNaN(units)){config.columnWidth=Math.floor((this.element.width()-this._getScrollBarWidth())*units-config.marginLeft)}}else if(config.columnWidth.indexOf("px")!==-1){units=config.columnWidth.substring(0,config.columnWidth.length-2);units=parseInt(units,10);if(!isNaN(units)){config.columnWidth=units;config.itemsRearrangable=true}else{throw new Error($.ig.TileManager.columnWidthUnitError+config.columnWidth)}}}else if(typeof config.columnWidth==="number"){config.itemsRearrangable=true}else if(!config.columnWidth&&!config.cols){config.cols=4}},_analyzeHeight:function(){var config=this.options.layoutConfiguration.gridLayout,units;if(config.rows&&!config.columnHeight){config.columnHeight=Math.floor(this.element.height()/config.rows)}else if(typeof config.columnHeight==="string"){if(config.columnHeight.indexOf("%")!==-1){units=config.columnHeight.substring(0,config.columnHeight.length-1);units=parseInt(units,10)/100;if(!isNaN(units)){config.columnHeight=Math.floor(this.element.height()*units-config.marginTop);config.rows=Math.floor(1/units)}}else if(config.columnHeight.indexOf("px")!==-1){units=config.columnHeight.substring(0,config.columnHeight.length-2);units=parseInt(units,10);if(!isNaN(units)){config.columnHeight=units}else{throw new Error($.ig.TileManager.columnHeightUnitError+config.columnHeight)}}}},_initFromMarkup:function(){var opt=this.options,elements,i,ratio,cols=0,rows=0,temp;elements=opt.itemSelector?this.element.children(opt.itemSelector):this.element.children();if(opt.layoutConfiguration.items.length===0){if(opt.layoutConfiguration.gridLayout.columnWidth){ratio=Math.floor(this.element.width()/(opt.layoutConfiguration.gridLayout.columnWidth+opt.layoutConfiguration.gridLayout.marginLeft))}else{ratio=opt.layoutConfiguration.gridLayout.cols}for(i=0;i<elements.length;i++){opt.layoutConfiguration.items.push({rowSpan:1,colSpan:1,colIndex:i%ratio,rowIndex:Math.floor(i/ratio),element:$(elements[i])})}if(!opt.layoutConfiguration.gridLayout.rows){opt.layoutConfiguration.gridLayout.rows=Math.ceil(opt.layoutConfiguration.items.length/ratio);if(!opt.layoutConfiguration.gridLayout.columnHeight){opt.layoutConfiguration.gridLayout.columnHeight=Math.floor(this.element.height()/rows-opt.layoutConfiguration.gridLayout.marginTop)}}if(!opt.layoutConfiguration.gridLayout.cols){opt.layoutConfiguration.gridLayout.cols=ratio}elements.addClass(this.css.content)}else{for(i=0;i<opt.layoutConfiguration.items.length;i++){temp=opt.layoutConfiguration.items[i].colIndex+opt.layoutConfiguration.items[i].colSpan;if(temp>cols){cols=temp}temp=opt.layoutConfiguration.items[i].rowIndex+opt.layoutConfiguration.items[i].rowSpan;if(temp>rows){rows=temp}if(!opt.layoutConfiguration.items[i].element){opt.layoutConfiguration.items[i].element=this.element.children(":eq("+i+")").addClass(this.css.content)}}if(!opt.layoutConfiguration.gridLayout.rows){opt.layoutConfiguration.gridLayout.rows=rows;if(!opt.layoutConfiguration.gridLayout.columnHeight){opt.layoutConfiguration.gridLayout.columnHeight=Math.floor(this.element.height()/rows-opt.layoutConfiguration.gridLayout.marginTop)}}if(!opt.layoutConfiguration.gridLayout.cols){opt.layoutConfiguration.gridLayout.cols=cols}}this.element.igLayoutManager(opt.layoutConfiguration);this.options.layoutConfiguration.gridLayout=this.element.igLayoutManager("option","gridLayout")},_initDataSource:function(){var opt=this.options,dataOpt;if(!opt.dataSource&&opt.dataSourceUrl){opt.dataSource=opt.dataSourceUrl}if(!(opt.dataSource instanceof $.ig.DataSource)){dataOpt={callback:this._renderData,callee:this,dataSource:opt.dataSource,requestType:opt.requestType,responseContentType:opt.responseContentType,responseDataType:opt.responseDataType,localSchemaTransform:false};if(opt.responseDataKey){dataOpt.responseDataKey=opt.responseDataKey}if(opt.dataSourceType){dataOpt.dataSourceType=opt.dataSourceType}opt.dataSource=new $.ig.DataSource(dataOpt)}},_renderData:function(success,msg,data){this._triggerDataBound(success,msg,data._data);if(success){var opt=this.options,ratio,self=this,i,cols=0,rows=0,temp,noCancel;if(opt.layoutConfiguration.items.length===0){if(opt.layoutConfiguration.gridLayout.columnWidth){ratio=Math.floor(this.element.width()/(opt.layoutConfiguration.gridLayout.columnWidth+opt.layoutConfiguration.gridLayout.marginLeft))}else{ratio=opt.layoutConfiguration.gridLayout.cols}for(i=0;i<data._data.length;i++){opt.layoutConfiguration.items.push({rowSpan:1,colSpan:1,colIndex:i%ratio,rowIndex:Math.floor(i/ratio)})}if(!opt.layoutConfiguration.gridLayout.rows){opt.layoutConfiguration.gridLayout.rows=Math.ceil(opt.layoutConfiguration.items.length/ratio);if(!opt.layoutConfiguration.gridLayout.columnHeight){opt.layoutConfiguration.gridLayout.columnHeight=Math.floor(this.element.height()/rows-opt.layoutConfiguration.gridLayout.marginTop)}}if(!opt.layoutConfiguration.gridLayout.cols){opt.layoutConfiguration.gridLayout.cols=ratio}}else{for(i=0;i<opt.layoutConfiguration.items.length;i++){temp=opt.layoutConfiguration.items[i].colIndex+opt.layoutConfiguration.items[i].colSpan;if(temp>cols){cols=temp}temp=opt.layoutConfiguration.items[i].rowIndex+opt.layoutConfiguration.items[i].rowSpan;if(temp>rows){rows=temp}}if(!opt.layoutConfiguration.gridLayout.rows){opt.layoutConfiguration.gridLayout.rows=rows;if(!opt.layoutConfiguration.gridLayout.columnHeight){opt.layoutConfiguration.gridLayout.columnHeight=Math.floor(this.element.height()/rows-opt.layoutConfiguration.gridLayout.marginTop)}}if(!opt.layoutConfiguration.gridLayout.cols){opt.layoutConfiguration.gridLayout.cols=cols}}noCancel=this._triggerRendering(data._data,opt.layoutConfiguration.items);if(noCancel){this.element.igLayoutManager($.extend(false,opt.layoutConfiguration,{itemRendered:function(event,ui){self._itemRendered(event,ui)},rendered:function(event,ui){self.element.find(".ui-igtile").each(function(index,element){self._setInnerContainerHeight($(this))});self._triggerRendered()}}));this.options.layoutConfiguration.gridLayout=this.element.igLayoutManager("option","gridLayout")}}else{throw new Error($.ig.TileManager.renderDataError)}},_itemRendered:function(event,ui){var element=ui.item,data=this.options.dataSource.data(),header,innerContainer;header='<div class="'+this.css.header+'">';if(this.options.headerTemplate){header+=$.ig.tmpl(this.options.headerTemplate,data[ui.index])}header+=this._renderExpandButton()+"</div>";innerContainer='<div class="'+this.css.innerContainer+'">'+$.ig.tmpl(this.options.contentTemplate,data[ui.index])+"</div>";element.addClass(this.css.content).html(header+innerContainer).attr("data-exp","expanded")},_renderMinimizeButton:function(){return'<span data-role="minimize" class="'+this.css.minimizeButton+'"><span class="'+this.css.minimizeIcon+'"></span></span>'},_renderExpandButton:function(){return'<span data-role="maximize" class="'+this.css.expandButton+'"><span class="'+this.css.expandIcon+'"></span></span>'},_attachEvents:function(){var self=this,noCancel;this._allvisible=true;this._animating=false;this.element.on("click",this.options.maximizeSelector,function(event){var item=$(this).closest(".ui-igtile");if(!self._animating){self._animating=true;if(!self._item||self._item.attr("id")!==item.attr("id")){noCancel=self._triggerTileFocusing(event,item);if(noCancel){self._handleFocusing(item,event)}else{self._animating=false}}else{if(self._item){noCancel=self._triggerTilesRestoring(event,self._item);if(noCancel){self._handleRestoring(item,event)}else{self._animating=false}}}}}).on("mouseover",".ig-button",function(event){$(this).addClass(self.css.hoverClass)}).on("mouseout",".ig-button",function(event){$(this).removeClass(self.css.hoverClass)}).on("iglayoutmanagerbeforeinternalresize",function(event){if(self._item){self._animating=true;noCancel=self._triggerTilesRestoring(event,self._item);if(noCancel){self._handleRestoring(self._item,event)}else{self._animating=false}}})},_handleFocusing:function(item,event){var self=this,gl=this.options.layoutConfiguration.gridLayout,newDimensions,useOffset=self.element.css("position")==="static",offset=self.element.offset(),previousFocusedTile=this._item,visibleRows=Math.floor(this.element.height()/(gl.columnHeight+gl.marginTop));this.element.find(".ui-igtile").not(item).each(function(index,element){var $el=$(this),isBelowTheFocusedTile=index>visibleRows-1,newDim={width:gl.columnWidth,height:gl.columnHeight,top:gl.marginTop+(gl.marginTop+gl.columnHeight)*(!isBelowTheFocusedTile?index:visibleRows+Math.floor((index-visibleRows)/gl.cols))+(useOffset?offset.top:0),left:gl.marginLeft+(gl.marginLeft+gl.columnWidth)*(!isBelowTheFocusedTile?gl.cols-1:(index-visibleRows)%gl.cols)+(useOffset?offset.left:0)};if(!self._item){$el.attr("data-old-left",$el.css("left"));$el.attr("data-old-top",$el.css("top"));$el.attr("data-height",$el.css("height"));$el.attr("data-width",$el.css("width"))}$el.animate(newDim,self.options.animationDuration,function(){if(!self._fromMarkup&&previousFocusedTile&&previousFocusedTile.attr("id")===$el.attr("id")){self._setInnerContainerHeight($el)}});if(!self._fromMarkup){$el.find(self.options.maximizeSelector).children().removeClass(self.css.collapseIcon).addClass(self.css.expandIcon)}});if(!this._item){item.attr("data-old-left",item.css("left"));item.attr("data-old-top",item.css("top"));item.attr("data-height",item.css("height"));item.attr("data-width",item.css("width"))}newDimensions={width:(gl.cols-1)*gl.columnWidth+(gl.cols-2>=0?gl.cols-2:0)*gl.marginLeft,height:visibleRows*gl.columnHeight+(visibleRows-1)*gl.marginTop,top:gl.marginTop+(useOffset?offset.top:0),left:gl.marginLeft+(useOffset?offset.left:0)};if(!self._fromMarkup){item.find(".ui-igtile-inner-container").height("100%")}item.animate(newDimensions,self.options.animationDuration,function(){self._animating=false;if(!self._fromMarkup){item.find(self.options.maximizeSelector).children().removeClass(self.css.expandIcon).addClass(self.css.collapseIcon);self._setInnerContainerHeight(item)}self._triggerTileFocused(null,item)});this._item=item},_handleRestoring:function(item,event){var self=this,oldDimensions={width:item.attr("data-width"),height:item.attr("data-height"),top:item.attr("data-old-top"),left:item.attr("data-old-left")};this._item.animate(oldDimensions,self.options.animationDuration,function(){item.removeAttr("data-width").removeAttr("data-height").removeAttr("data-old-left").removeAttr("data-old-top");self._animating=false;if(!self._fromMarkup){self._setInnerContainerHeight(item)}self._triggerTilesRestored(null)});this.element.find(".ui-igtile").not(this._item).each(function(index,element){var $el=$(this),oldDim={width:$el.attr("data-width"),height:$el.attr("data-height"),left:$el.attr("data-old-left"),top:$el.attr("data-old-top")};$el.animate(oldDim,self.options.animationDuration,function(){$el.removeAttr("data-width").removeAttr("data-height").removeAttr("data-old-left").removeAttr("data-old-top")})});if(!this._fromMarkup){item.find(self.options.maximizeSelector).children().removeClass(this.css.collapseIcon).addClass(this.css.expandIcon)}delete this._item},_getScrollBarWidth:function(){var el=$('<div style="width: 100px; height: 100px; position: absolute; top: -10000px; left: -10000px; overflow: scroll"></div>').appendTo($(document.body)),scrollWidth;scrollWidth=el[0].offsetWidth-el[0].clientWidth;el.remove();return scrollWidth},_setInnerContainerHeight:function(igTile){var innerContainer=igTile.find(".ui-igtile-inner-container");innerContainer.height(igTile.height()-(innerContainer.outerHeight(true)-innerContainer.height())-igTile.find(".ui-igtile-header").outerHeight(true))},_triggerDataBinding:function(){var args={owner:this,dataSource:this.options.dataSource};return this._trigger(this.events.dataBinding,null,args)},_triggerDataBound:function(success,msg,dataView){var args={owner:this,success:success,errorMessage:msg,dataView:dataView};this._trigger(this.events.dataBound,null,args)},_triggerRendering:function(data,items){var args={owner:this,data:data,items:items};return this._trigger(this.events.rendering,null,args)},_triggerRendered:function(){this._trigger(this.events.rendered,null,{owner:this})},_triggerTileFocusing:function(event,tile){var args={owner:this,index:tile.index(),element:tile};return this._trigger(this.events.tileFocusing,event,args)},_triggerTileFocused:function(event,tile){var args={owner:this,index:tile.index(),element:tile};this._trigger(this.events.tileFocused,event,args)},_triggerTilesRestoring:function(event,tile){var args={owner:this,focusedTile:tile};return this._trigger(this.events.tilesRestoring,event,args)},_triggerTilesRestored:function(){this._trigger(this.events.tilesRestored,null,{owner:this})},_triggerTileMinimizing:function(event,tile){var args={owner:this,index:tile.index(),element:tile};return this._trigger(this.events.tileMinimizing,event,args)},_triggerTileMinimized:function(tile){var args={owner:this,index:tile.index(),element:tile};this._trigger(this.events.tileMinimized,null,args)},_triggerTileMaximizing:function(event,tile){var args={owner:this,index:tile.index(),element:tile};return this._trigger(this.events.tileMaximizing,event,args)},_triggerTileMaximized:function(tile){var args={owner:this,index:tile.index(),element:tile};this._trigger(this.events.tileMaximized,null,args)},dataBind:function(){var noCancel;this._initDataSource();noCancel=this._triggerDataBinding();if(noCancel){this.options.dataSource.dataBind(this._renderData,this)}},destroy:function(){$.Widget.prototype.destroy.apply(this,arguments);this.element.igLayoutManager("destroy");this.element.removeClass(this.css.container);if(!this._fromMarkup){this.element.empty()}else{this.element.children().removeClass(this.css.content)}this.element.unbind();return this}});$.extend($.ui.igTileManager,{version:"13.1.20131.2143"})})(jQuery);(function($){$(document).ready(function(){var wm=$("#__ig_wm__").length>0?$("#__ig_wm__"):$('<div id="__ig_wm__"></div>').appendTo(document.body);wm.css({position:"fixed",bottom:0,right:0,zIndex:1e3}).addClass("ui-igtrialwatermark")})})(jQuery);